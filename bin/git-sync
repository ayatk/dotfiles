#!/bin/sh
# http://qiita.com/masarakki/items/27f2cb456b4801ccb31b

git fetch --all --prune

modified=`git status | grep modified | wc -l`
if [ $modified -gt 0 ]; then
  git stash -a
fi

branch=`git branch | grep '*' | cut -f 2 -d ' '`
git checkout master
git pull --rebase origin master
if [ $branch != 'master' ] ; then
  if [ `git branch --merged | grep ${branch} | wc -l` -eq 1 ]; then
    git branch -d ${branch}
  else
    git checkout ${branch}
  fi
fi

if [ $modified -gt 0 ]; then
  git stash pop
fi
